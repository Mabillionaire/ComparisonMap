<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui' />
    <title>North Dakota School District Boundaries - Comparison Tool</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
   <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
   
    <style>
    body {
        margin: 0;
        padding: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header h1 {
        margin: 0;
        font-size: 2.5em;
        font-weight: 300;
    }
    .header p {
        margin: 10px 0 0 0;
        opacity: 0.9;
        font-size: 1.1em;
    }
    .info-panel {
        background: white;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin: 20px;
        border-radius: 8px;
    }
    .info-panel h3 {
        margin: 0 0 15px 0;
        color: #333;
    }
    .info-panel p {
        margin: 5px 0;
        color: #6c757d;
        line-height: 1.6;
    }
    #map {
        position: absolute;
        top: 120px;
        bottom: 0;
        width: 100%;
    }
    
    /* Split Screen Comparison Styles */
    .leaflet-compare {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        z-index: 1000;
    }
    
    .leaflet-compare-range {
        position: absolute !important;
        top: 50% !important;
        left: 0 !important;
        width: 100% !important;
        z-index: 1001;
        -webkit-appearance: none;
        display: inline-block !important;
        vertical-align: middle;
        height: 0;
        padding: 0;
        margin: 0;
        border: 0;
        background: rgba(0, 0, 0, 0.25);
        min-width: 100px;
        cursor: pointer;
        pointer-events: auto;
        transform: translateY(-50%);
    }
    
    .leaflet-compare-range::-webkit-slider-thumb {
        -webkit-appearance: none;
        margin: 0;
        padding: 0;
        background: #fff;
        height: 40px;
        width: 40px;
        border-radius: 20px;
        cursor: ew-resize;
        pointer-events: auto;
        border: 2px solid #667eea;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .leaflet-compare-range::-moz-range-thumb {
        padding: 0;
        background: #fff;
        height: 40px;
        width: 40px;
        border-radius: 20px;
        cursor: ew-resize;
        pointer-events: auto;
        border: none;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .leaflet-compare-range::-ms-thumb {
        margin: 0;
        padding: 0;
        background: #fff;
        height: 40px;
        width: 40px;
        border-radius: 20px;
        cursor: ew-resize;
        pointer-events: auto;
        border: 2px solid #667eea;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }
    
    .leaflet-compare-range:focus {
        outline: none !important;
    }
    
    .leaflet-compare-divider {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 50%;
        margin-left: -2px;
        width: 4px;
        background-color: #667eea;
        pointer-events: none;
        z-index: 1000;
        box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    </style>
</head>

<body>
    <div class="header">
        <h1>üè´ North Dakota School District Boundaries</h1>
        <p>Compare 2024 vs. 2025 school district boundaries (170 ‚Üí 172 districts)</p>
    </div>
    
    <div class="info-panel">
        <h3>üìã How to Use This Tool</h3>
        <p><strong>Left Side (Red):</strong> 2024 school district boundaries (170 districts)</p>
        <p><strong>Right Side (Blue):</strong> 2025 school district boundaries (172 districts)</p>
        <p><strong>Drag the divider line</strong> left or right to compare the two datasets side by side</p>
    </div>
    
    <div id='map'></div>

    <!-- North Dakota School District Data -->
    <script src="nd_boundaries_data.js"></script>
    
         <script>
     // Split Screen Comparison Control Class
     class SplitScreenControl {
         constructor(map) {
             this.map = map;
             this.position = 0.5;
             
             // Initialize the control
             this.init();
         }
         
         init() {
             // Create container and position it over the map
             this.container = L.DomUtil.create('div', 'leaflet-compare');
             this.container.style.position = 'absolute';
             this.container.style.top = '0';
             this.container.style.left = '0';
             this.container.style.right = '0';
             this.container.style.bottom = '0';
             this.container.style.pointerEvents = 'none';
             this.container.style.zIndex = '1000';
             this.container.style.width = '100%';
             this.container.style.height = '100%';
             
             // Create divider
             this.divider = L.DomUtil.create('div', 'leaflet-compare-divider', this.container);
             
             // Create range input
             this.range = L.DomUtil.create('input', 'leaflet-compare-range', this.container);
             this.range.type = 'range';
             this.range.min = 0;
             this.range.max = 1;
             this.range.step = 'any';
             this.range.value = this.position;
             this.range.style.width = '100%';
             this.range.style.position = 'absolute';
             this.range.style.top = '50%';
             this.range.style.left = '0';
             this.range.style.transform = 'translateY(-50%)';
             
             // Add events
             this.addEvents();
             
             // Initial update
             this.updateClip();
             
             // Add container to map pane
             const mapPane = this.map.getPanes().overlayPane;
             mapPane.appendChild(this.container);
         }
         
         addEvents() {
             this.range.addEventListener('input', this.updateClip.bind(this));
             this.range.addEventListener('mousedown', this.cancelMapDrag.bind(this));
             this.range.addEventListener('mouseup', this.uncancelMapDrag.bind(this));
             this.range.addEventListener('touchstart', this.cancelMapDrag.bind(this));
             this.range.addEventListener('touchend', this.uncancelMapDrag.bind(this));
             
             this.map.on('move', this.updateClip, this);
         }
         
         removeEvents() {
             this.range.removeEventListener('input', this.updateClip.bind(this));
             this.range.removeEventListener('mousedown', this.cancelMapDrag.bind(this));
             this.range.removeEventListener('mouseup', this.cancelMapDrag.bind(this));
             this.range.removeEventListener('touchstart', this.cancelMapDrag.bind(this));
             this.range.removeEventListener('touchend', this.uncancelMapDrag.bind(this));
             
             this.map.off('move', this.updateClip, this);
         }
         
         cancelMapDrag() {
             this.map.dragging.disable();
             if (this.map.tap) this.map.tap.disable();
         }
         
         uncancelMapDrag() {
             this.map.dragging.enable();
             if (this.map.tap) this.map.tap.enable();
         }
         
         updateClip() {
             if (!this.map) return;
             
             const mapSize = this.map.getSize();
             const rangeValue = parseFloat(this.range.value);
             const dividerX = mapSize.x * rangeValue;
             
             // Update divider position
             this.divider.style.left = `${dividerX}px`;
             
             // Apply clipping to map panes
             if (this.map.getPane("left") && this.map.getPane("right")) {
                 // Apply clipping to left pane (current boundaries)
                 this.map.getPane("left").style.clipPath = `inset(0 ${100 - (rangeValue * 100)}% 0 0)`;
                 
                 // Apply clipping to right pane (proposed boundaries)
                 this.map.getPane("right").style.clipPath = `inset(0 0 0 ${rangeValue * 100}%)`;
             }
         }
         
         setPosition(position) {
             this.position = position;
             if (this.range) {
                 this.range.value = position;
                 this.updateClip();
             }
             return this;
         }
         
         getPosition() {
             return this.range ? parseFloat(this.range.value) : this.position;
         }
         
         remove() {
             this.removeEvents();
             if (this.container && this.container.parentNode) {
                 this.container.parentNode.removeChild(this.container);
             }
             this.map = null;
         }
     }
     
     // Initialize the map centered on North Dakota
     const map = L.map('map').setView([47.5515, -100.0020], 7);

    // Add OpenStreetMap basemap
    const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors',
        maxZoom: 19
    }).addTo(map);

    // Create panes for left and right sides
    map.createPane("left");
    map.createPane("right");

    // Load the boundary data
    let currentBoundaries = [];
    let proposedBoundaries = [];

    try {
        // Load current boundaries (2024)
        currentBoundaries = currentBoundariesData;
        
        // Load proposed boundaries (2025)
        proposedBoundaries = proposedBoundariesData;
        
        console.log('Boundary data loaded successfully!');
        console.log('Current boundaries:', currentBoundaries.length);
        console.log('Proposed boundaries:', proposedBoundaries.length);
        
    } catch (error) {
        console.error('Error loading boundary data:', error);
        alert('Error loading boundary data: ' + error.message);
    }

    // Create current boundaries layer (left pane)
    const currentLayer = L.layerGroup();
    currentBoundaries.forEach(boundary => {
        const polygon = L.polygon(boundary.coordinates, {
            pane: "left",
            color: 'red',
            weight: 2,
            fillColor: 'red',
            fillOpacity: 0.3
        });
        
        // Bind popup
        polygon.bindPopup(`<b>${boundary.name}</b><br><strong>Current Boundary (2024)</strong><br>District ID: ${boundary.properties.DISTRICT_ID}<br>County: ${boundary.properties.COUNTY}`);
        
        currentLayer.addLayer(polygon);
    });

    // Create proposed boundaries layer (right pane)
    const proposedLayer = L.layerGroup();
    proposedBoundaries.forEach(boundary => {
        const polygon = L.polygon(boundary.coordinates, {
            pane: "right",
            color: 'blue',
            weight: 2,
            fillColor: 'blue',
            fillOpacity: 0.3
        });
        
        // Bind popup
        polygon.bindPopup(`<b>${boundary.name}</b><br><strong>Proposed Boundary (2025)</strong><br>District ID: ${boundary.properties.DISTRICT_ID}<br>County: ${boundary.properties.COUNTY}`);
        
        proposedLayer.addLayer(polygon);
    });

    // Add both layers to the map
    currentLayer.addTo(map);
    proposedLayer.addTo(map);

    // Create the compare control using leaflet-compare plugin
    console.log('Creating compare control...');
    
    // Create the split-screen control manually instead of using the plugin interface
    const compareControl = new SplitScreenControl(map);
    console.log('Compare control created:', compareControl);
    
    // Debug: Check if the control is properly positioned
    setTimeout(() => {
        if (compareControl && compareControl.container) {
            console.log('Control container styles:', compareControl.container.style.cssText);
            console.log('Control container position:', compareControl.container.getBoundingClientRect());
        }
    }, 1000);

    // Fit map to show all boundaries
    const allBounds = [];
    currentBoundaries.forEach(boundary => {
        allBounds.push(boundary.coordinates);
    });
    proposedBoundaries.forEach(boundary => {
        allBounds.push(boundary.coordinates);
    });
    
         if (allBounds.length > 0) {
         const bounds = L.latLngBounds(allBounds.flat());
         map.fitBounds(bounds, { padding: [20, 20] });
     }
     </script>
</body>
</html>
