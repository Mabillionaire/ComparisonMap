<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>North Dakota School District Boundaries - Comparison Tool</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Custom CSS -->
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .info-panel {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .info-panel h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .info-panel p {
            margin: 5px 0;
            color: #6c757d;
            line-height: 1.6;
        }
        
        .controls {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .control-group label {
            font-weight: 600;
            color: #333;
            min-width: 120px;
        }
        
        .slider-container {
            flex: 1;
            min-width: 300px;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .slider-value {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            min-width: 60px;
            text-align: center;
        }
        
        .dataset-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .dataset-info h3 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        
        .dataset-info p {
            margin: 5px 0;
            color: #6c757d;
        }
        
        .map-container {
            height: 70vh;
            margin: 0 20px 20px 20px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            position: relative;
        }
        
        #map {
            height: 100%;
            width: 100%;
        }
        
        .legend {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 0 20px 20px 20px;
        }
        
        .legend h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
            border: 1px solid #ddd;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px;
            border: 1px solid #f5c6cb;
        }
        
        /* Split Screen Comparison Styles */
        .leaflet-sbs {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1000;
        }
        
        .leaflet-sbs-range {
            position: absolute;
            top: 50%;
            width: 100%;
            z-index: 1001;
            -webkit-appearance: none;
            display: inline-block !important;
            vertical-align: middle;
            height: 0;
            padding: 0;
            margin: 0;
            border: 0;
            background: rgba(0, 0, 0, 0.25);
            min-width: 100px;
            cursor: pointer;
            pointer-events: auto;
        }
        
        .leaflet-sbs-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            margin: 0;
            padding: 0;
            background: #fff;
            height: 40px;
            width: 40px;
            border-radius: 20px;
            cursor: ew-resize;
            pointer-events: auto;
            border: 2px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .leaflet-sbs-range::-moz-range-thumb {
            padding: 0;
            background: #fff;
            height: 40px;
            width: 40px;
            border-radius: 20px;
            cursor: ew-resize;
            pointer-events: auto;
            border: 2px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .leaflet-sbs-range::-ms-thumb {
            margin: 0;
            padding: 0;
            background: #fff;
            height: 40px;
            width: 40px;
            border-radius: 20px;
            cursor: ew-resize;
            pointer-events: auto;
            border: 2px solid #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .leaflet-sbs-range:focus {
            outline: none !important;
        }
        
        .leaflet-sbs-divider {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -2px;
            width: 4px;
            background-color: #667eea;
            pointer-events: none;
            z-index: 1000;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .control-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .control-group label {
                min-width: auto;
            }
            
            .slider-container {
                min-width: auto;
            }
            
            .map-container {
                margin: 0 10px 20px 10px;
                height: 60vh;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè´ North Dakota School District Boundaries</h1>
        <p>Compare 2024 vs. 2025 school district boundaries (170 ‚Üí 172 districts)</p>
    </div>
    
    <div class="info-panel">
        <h3>üìã How to Use This Tool</h3>
        <p><strong>Left Side (Red):</strong> 2024 school district boundaries (170 districts)</p>
        <p><strong>Right Side (Blue):</strong> 2025 school district boundaries (172 districts)</p>
        <p><strong>Drag the divider line</strong> left or right to compare the two datasets side by side</p>
        <p><strong>Use the slider below</strong> for precise control over the split view</p>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label for="comparisonSlider">Comparison Slider:</label>
            <div class="slider-container">
                <input type="range" id="comparisonSlider" class="slider" min="0" max="100" value="50">
            </div>
            <div class="slider-value" id="sliderValue">50%</div>
        </div>
        
        <div class="control-group">
            <label>Current View:</label>
            <div id="currentView">Split view (50% Current, 50% Proposed)</div>
        </div>
    </div>
    
    <div class="dataset-info">
        <h3>üìä Dataset Information</h3>
        <p><strong>Current Boundaries:</strong> <span id="currentInfo">Loading...</span></p>
        <p><strong>Proposed Boundaries:</strong> <span id="proposedInfo">Loading...</span></p>
        <p><strong>Total Districts:</strong> <span id="totalDistricts">Calculating...</span></p>
    </div>
    
    <div class="map-container">
        <div id="map"></div>
    </div>
    
    <div class="legend">
        <h3>üó∫Ô∏è Map Legend</h3>
        <div class="legend-item">
            <div class="legend-color" style="background: rgba(255, 0, 0, 0.7);"></div>
            <span>Current Boundaries (Red)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: rgba(0, 0, 255, 0.7);"></div>
            <span>Proposed Boundaries (Blue)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #667eea;"></div>
            <span>Divider Line (Blue)</span>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- North Dakota School District Data -->
    <script src="nd_boundaries_data.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Initialize the map centered on North Dakota
        const map = L.map('map').setView([47.5515, -100.0020], 7); // Center of North Dakota
        
        // Add OpenStreetMap basemap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);
        
                                   // Create map panes for left and right sides (like leaflet-compare plugin)
          map.createPane("left");
          map.createPane("right");
          
          // Store references to panes
          map.leftPane = map.getPane("left");
          map.rightPane = map.getPane("right");
        
        // Split screen comparison control
        let splitControl = null;
        
        // Data storage
        let currentBoundaries = [];
        let proposedBoundaries = [];
        
        // ========================================
        // NORTH DAKOTA SCHOOL DISTRICT DATA
        // ========================================
        
        // Data is loaded from external JavaScript files:
        // - currentBoundariesData (2024 boundaries)
        // - proposedBoundariesData (2025 boundaries)
        
        // ========================================
        // END OF DATA REPLACEMENT SECTION
        // ========================================
        
        // Load the data
        function loadBoundaryData() {
            try {
                // Load current boundaries
                currentBoundaries = currentBoundariesData;
                
                // Load proposed boundaries
                proposedBoundaries = proposedBoundariesData;
                
                // Update UI
                updateUI();
                
                // Create map layers
                createMapLayers();
                
                // Fit map to show all boundaries
                fitMapToBoundaries();
                
                console.log('Boundary data loaded successfully!');
                
            } catch (error) {
                console.error('Error loading boundary data:', error);
                showError('Error loading boundary data: ' + error.message);
            }
        }
        
        // Update UI with dataset information
        function updateUI() {
            document.getElementById('currentInfo').textContent = 
                `${currentBoundaries.length} school districts`;
            document.getElementById('proposedInfo').textContent = 
                `${proposedBoundaries.length} school districts`;
            document.getElementById('totalDistricts').textContent = 
                `${Math.max(currentBoundaries.length, proposedBoundaries.length)} total districts`;
        }
        
                          // Create map layers
          function createMapLayers() {
              // Clear existing boundary layers
              if (map.currentBoundaryLayers) {
                  map.currentBoundaryLayers.forEach(layer => layer.remove());
                  map.currentBoundaryLayers = [];
              }
              if (map.proposedBoundaryLayers) {
                  map.proposedBoundaryLayers.forEach(layer => layer.remove());
                  map.proposedBoundaryLayers = [];
              }
             
                          // Add current boundaries to left pane
              if (currentBoundaries.length > 0) {
                  if (!map.currentBoundaryLayers) map.currentBoundaryLayers = [];
                  
                  currentBoundaries.forEach(boundary => {
                      const polygon = L.polygon(boundary.coordinates, {
                          color: 'red',
                          weight: 2,
                          fillColor: 'red',
                          fillOpacity: 0.3,
                          pane: 'left'
                      });
                      
                      // Add to the map (will automatically go to left pane)
                      polygon.addTo(map);
                      
                      // Bind popup
                      polygon.bindPopup(`<b>${boundary.name}</b><br><strong>Current Boundary</strong><br>District ID: ${boundary.properties.DISTRICT_ID}<br>County: ${boundary.properties.COUNTY}`);
                      
                      // Store reference for later use
                      map.currentBoundaryLayers.push(polygon);
                  });
              }
             
                          // Add proposed boundaries to right pane
              if (proposedBoundaries.length > 0) {
                  if (!map.proposedBoundaryLayers) map.proposedBoundaryLayers = [];
                  
                  proposedBoundaries.forEach(boundary => {
                      const polygon = L.polygon(boundary.coordinates, {
                          color: 'blue',
                          weight: 2,
                          fillColor: 'blue',
                          fillOpacity: 0.3,
                          pane: 'right'
                      });
                      
                      // Add to the map (will automatically go to right pane)
                      polygon.addTo(map);
                      
                      // Bind popup
                      polygon.bindPopup(`<b>${boundary.name}</b><br><strong>Proposed Boundary</strong><br>District ID: ${boundary.properties.DISTRICT_ID}<br>County: ${boundary.properties.COUNTY}`);
                      
                      // Store reference for later use
                      map.proposedBoundaryLayers.push(polygon);
                  });
              }
            
            // Create split screen comparison control
            if (currentBoundaries.length > 0 && proposedBoundaries.length > 0) {
                if (splitControl) {
                    splitControl.remove();
                }
                
                                 // Create split control directly
                 try {
                     splitControl = new SplitScreenControl(map);
                     console.log('Split control created successfully');
                 } catch (error) {
                     console.error('Error creating split control:', error);
                 }
            }
        }
        
        // Fit map to show all boundaries
        function fitMapToBoundaries() {
            const allBounds = [];
            
            currentBoundaries.forEach(boundary => {
                allBounds.push(boundary.coordinates);
            });
            
            proposedBoundaries.forEach(boundary => {
                allBounds.push(boundary.coordinates);
            });
            
            if (allBounds.length > 0) {
                const bounds = L.latLngBounds(allBounds.flat());
                map.fitBounds(bounds, { padding: [20, 20] });
            }
        }
        
                 // Split Screen Comparison Control
         class SplitScreenControl {
             constructor(map) {
                 this.map = map;
                 this.position = 0.5;
                 
                 // Initialize the control
                 this.init();
             }
            
             init() {
                 // Create container and position it over the map
                 this.container = L.DomUtil.create('div', 'leaflet-sbs');
                 this.container.style.position = 'absolute';
                 this.container.style.top = '0';
                 this.container.style.left = '0';
                 this.container.style.right = '0';
                 this.container.style.bottom = '0';
                 this.container.style.pointerEvents = 'none';
                 this.container.style.zIndex = '1000';
                 
                 // Create divider
                 this.divider = L.DomUtil.create('div', 'leaflet-sbs-divider', this.container);
                 
                 // Create range input
                 this.range = L.DomUtil.create('input', 'leaflet-sbs-range', this.container);
                 this.range.type = 'range';
                 this.range.min = 0;
                 this.range.max = 1;
                 this.range.step = 'any';
                 this.range.value = this.position;
                 
                 // Add events
                 this.addEvents();
                 
                 // Initial update
                 this.updateClip();
                 
                 // Add container to map pane
                 const mapPane = this.map.getPanes().overlayPane;
                 mapPane.appendChild(this.container);
             }
            
             remove() {
                 this.removeEvents();
                 if (this.container && this.container.parentNode) {
                     this.container.parentNode.removeChild(this.container);
                 }
                 this.map = null;
             }
            
            addEvents() {
                this.range.addEventListener('input', this.updateClip.bind(this));
                this.range.addEventListener('mousedown', this.cancelMapDrag.bind(this));
                this.range.addEventListener('mouseup', this.uncancelMapDrag.bind(this));
                this.range.addEventListener('touchstart', this.cancelMapDrag.bind(this));
                this.range.addEventListener('touchend', this.uncancelMapDrag.bind(this));
                
                this.map.on('move', this.updateClip, this);
            }
            
            removeEvents() {
                this.range.removeEventListener('input', this.updateClip.bind(this));
                this.range.removeEventListener('mousedown', this.cancelMapDrag.bind(this));
                this.range.removeEventListener('mouseup', this.uncancelMapDrag.bind(this));
                this.range.removeEventListener('touchstart', this.cancelMapDrag.bind(this));
                this.range.removeEventListener('touchend', this.uncancelMapDrag.bind(this));
                
                this.map.off('move', this.updateClip, this);
            }
            
            cancelMapDrag() {
                this.map.dragging.disable();
                if (this.map.tap) this.map.tap.disable();
            }
            
            uncancelMapDrag() {
                this.map.dragging.enable();
                if (this.map.tap) this.map.tap.enable();
            }
            
                         updateClip() {
                 if (!this.map) return;
                 
                 const mapSize = this.map.getSize();
                 const rangeValue = parseFloat(this.range.value);
                 const dividerX = mapSize.x * rangeValue;
                 
                 // Update divider position
                 this.divider.style.left = `${dividerX}px`;
                 
                 // Apply clipping to map panes (like leaflet-compare plugin)
                 if (this.map.leftPane && this.map.rightPane) {
                     // Apply clipping to left pane (current boundaries)
                     this.map.leftPane.style.clipPath = `inset(0 ${100 - (rangeValue * 100)}% 0 0)`;
                     
                     // Apply clipping to right pane (proposed boundaries)
                     this.map.rightPane.style.clipPath = `inset(0 0 0 ${rangeValue * 100}%)`;
                 }
                 
                 // Update slider value display
                 const sliderValue = document.getElementById('sliderValue');
                 if (sliderValue) {
                     sliderValue.textContent = Math.round(rangeValue * 100) + '%';
                 }
                 
                 // Update current view text
                 const currentView = document.getElementById('currentView');
                 if (currentView) {
                     const currentPercent = Math.round(rangeValue * 100);
                     const proposedPercent = 100 - currentPercent;
                     currentView.textContent = `Split view (${currentPercent}% Current, ${proposedPercent}% Proposed)`;
                 }
             }
            
            setPosition(position) {
                this.position = position;
                if (this.range) {
                    this.range.value = position;
                    this.updateClip();
                }
                return this;
            }
            
            getPosition() {
                return this.range ? parseFloat(this.range.value) : this.position;
            }
        }
        
        // Show error message
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            errorDiv.style.margin = '20px';
            
            // Remove existing error messages
            document.querySelectorAll('.error').forEach(el => el.remove());
            
            // Insert new error message after header
            document.querySelector('.header').after(errorDiv);
        }
        
        // Initialize the application
        function init() {
            try {
                // Load boundary data
                loadBoundaryData();
                
                // Comparison slider event handler
                document.getElementById('comparisonSlider').addEventListener('input', function(e) {
                    const value = e.target.value;
                    const position = value / 100;
                    
                    if (splitControl) {
                        splitControl.setPosition(position);
                    }
                });
                
                console.log('North Dakota School District Comparison Tool loaded successfully!');
                
            } catch (error) {
                console.error('Error initializing application:', error);
                showError('Error initializing application: ' + error.message);
            }
        }
        
        // Start the application when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
